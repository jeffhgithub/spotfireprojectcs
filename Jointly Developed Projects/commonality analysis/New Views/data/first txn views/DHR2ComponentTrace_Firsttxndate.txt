PROCEDURE DHR2ComponentTrace_FirstTXNDate (    
	IN containerIdsList VARCHAR(40000), 
    OUT result CURSOR (
	  ModuleContainer varchar (255), 
	  ComponentBatch varchar (255),
	  Component varchar (30), 
	  ComponentDesc varchar (255),
	  Operation varchar (30),
	  OperatorID varchar (255),
	  ReferenceDesignator varchar (30),
	  TxnDate timestamp,
	  Qty double,
	  OperDesc  varchar (255),
	  VendorBatch varchar (30),
	  ZbPosition bigint
      )
    )
    BEGIN
        OPEN result FOR 
			concat(concat('SELECT DISTINCT
			CONTAINER.ContainerName as ModuleContainer, 
			CONTAINER_ISSUED.CONTAINERNAME as ComponentBatch,
			PRODUCTBASE.PRODUCTNAME as Component, 
			PRODUCT.DESCRIPTION as ComponentDesc,
			OPERATION.OperationName as Operation,
			EMPLOYEE.ZBOPERATORID as OperatorID,
			ISSUEACTUALSHISTORY.REFERENCEDESIGNATOR as ReferenceDesignator,
			HISTORYMAINLINE.TXNDATE as TxnDate,
			ISSUEACTUALSHISTORY.Qty as Qty,
			OPERATION.DESCRIPTION as OperDesc,
			ZCINCOMINGDETAIL.ZCVENDORBATCH as VendorBatch,
			CONTAINER.ZBPOSITION as ZbPosition
			FROM
			/shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/CONTAINER
			INNER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/HISTORYCROSSREF ON (HISTORYCROSSREF.TRACKINGID=CONTAINER.CONTAINERID)
			INNER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/HISTORYMAINLINE  HISTORYMAINLINE ON (HISTORYMAINLINE.HISTORYID=HISTORYCROSSREF.HISTORYID AND HISTORYMAINLINE.TXNID BETWEEN HISTORYCROSSREF.STARTTXNID AND HISTORYCROSSREF.ENDTXNID)
			INNER JOIN /shared/MES7/CommonalityAnalysis/NewViews/Intermediate/FirstHistoryMainLine(containerIdsList) hist_A ON hist_A.HISTORYID = HISTORYMAINLINE.HISTORYID AND hist_A.FirstTXNDATE = HISTORYMAINLINE.TXNDATE 
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/COMPONENTISSUEHISTORY ON (COMPONENTISSUEHISTORY.HISTORYMAINLINEID=HISTORYMAINLINE.HISTORYMAINLINEID)
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ISSUEHISTORYDETAIL ON (ISSUEHISTORYDETAIL.COMPONENTISSUEHISTORYID=COMPONENTISSUEHISTORY.COMPONENTISSUEHISTORYID)
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ISSUEACTUALSHISTORY ON (ISSUEACTUALSHISTORY.ISSUEHISTORYDETAILID=ISSUEHISTORYDETAIL.ISSUEHISTORYDETAILID)
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/PRODUCT  PRODUCT ON (PRODUCT.PRODUCTID=ISSUEACTUALSHISTORY.PRODUCTID)
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/PRODUCTBASE  PRODUCTBASE ON (PRODUCTBASE.PRODUCTBASEID=PRODUCT.PRODUCTBASEID)
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/CONTAINER  CONTAINER_ISSUED ON (CONTAINER_ISSUED.CONTAINERID=ISSUEACTUALSHISTORY.FROMCONTAINERID)
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZCINCOMINGDETAIL  ZCINCOMINGDETAIL ON (ZCINCOMINGDETAIL.ZCINCOMINGDETAILID=CONTAINER_ISSUED.ZCINCOMINGDETAILID)
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/EMPLOYEE ON (EMPLOYEE.EMPLOYEEID=HISTORYMAINLINE.EMPLOYEEID)
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/OPERATION ON (HISTORYMAINLINE.OPERATIONID=OPERATION.OPERATIONID)
			WHERE
			CONTAINER.LEVELID = ''00052820000000b4'' AND 
			HISTORYMAINLINE.TXNTYPE in (4719017,4719023,4719024) AND 
			CONTAINER.CONTAINERID in (',containerIdsList),')');
    END
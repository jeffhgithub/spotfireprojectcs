PROCEDURE DHR7NCRDetails_FirstTestOrder (    
	IN containerIdsList VARCHAR(40000), 
    OUT result CURSOR (
		ModuleContainer varchar (255), 
		nonConformanceCode varchar (30), 
		TxnDate timestamp, 
		NCRCreationDate timestamp, 
		NCRCloseDate timestamp, 
		CCAR varchar (30), 
		RCCodeDesc varchar (255), 
		OperatorID varchar (255), 
		DispositionCode varchar (30), 
		Workflow varchar (50), 
		NCReferenceDesignator varchar (255), 
		FailureModeCode varchar (30), 
		FailModeCodeDesc varchar (255), 
		FMReferenceDesignator varchar (255), 
		NCRStatus bigint,
		NCRStatDesc varchar (9), 
		Component varchar (30), 
		RootCauseCode varchar (30), 
		WorkflowStep varchar (2000), 
		NonConformanceReport varchar (30), 
		CDOName varchar (37), 
		NCCodeDesc varchar (255),
		ZbPosition bigint,
		TestPlanHistoryID char (16),
		TestOrder bigint,
		TestName varchar (50),
		NCRCOMMENT varchar (256),
		NonconformanceReportName varchar (30)
      )
    )
    BEGIN
        OPEN result FOR 
			concat(concat('SELECT distinct
				CONTAINER.CONTAINERNAME ModuleContainer, 
				ZCNONCONFORMANCECODE.ZCNONCONFORMANCECODENAME NonConformanceCode, 
				HISTORYMAINLINE.TXNDATE TxnDate, 
				NCR.CREATIONDATE NCRCreationDate, 
				NCR.CLOSEDATE NCRCloseDate, 
				ICAR.ZCCARNAME CCAR, 
				ZCROOTCAUSECODE.DESCRIPTION RCCodeDesc, 
				EMPLOYEE.ZBOPERATORID OperatorID, 
				ZCDISPOSITIONCODE.ZCDISPOSITIONCODENAME DispositionCode, 
				NCC_WORKFLOWBASE.WORKFLOWNAME Workflow, 
				NCR.ZCNCREFERENCEDESIGNATOR NCReferenceDesignator, 
				ZCFAILUREMODECODE.ZCFAILUREMODECODENAME FailureModeCode, 
				ZCFAILUREMODECODE.DESCRIPTION FailModeCodeDesc, 
				NCR.ZCFMREFERENCEDESIGNATOR FMReferenceDesignator, 
				NCR.NCRSTATUS NCRStatus, 
				CASE 
					WHEN NCR.NCRSTATUS = 0
						THEN ''Deleted''
					WHEN NCR.NCRSTATUS = 1
						THEN ''Created''
					WHEN NCR.NCRSTATUS = 2
						THEN ''Reviewed''
					WHEN NCR.NCRSTATUS = 3
						THEN ''Analyzed''
					WHEN NCR.NCRSTATUS = 5
						THEN ''Completed''
					WHEN NCR.NCRSTATUS = 9
						THEN ''Closed''
					ELSE NULL
					END NCRStatDesc, 
				Table__359.PRODUCTNAME Component, 
				ZCROOTCAUSECODE.ZCROOTCAUSECODENAME RootCauseCode, 
				Table__140.WORKFLOWSTEPNAME WorkflowStep, 
				NCR.NONCONFORMANCEREPORTNAME NonConformanceReport, 
				CDODEFINITION.CDONAME CDOName, 
				ZCNONCONFORMANCECODE.DESCRIPTION NCCodeDesc,
				CONTAINER.ZBPOSITION as ZbPosition,
				ZBTESTPLANHISTORY.ZBTESTPLANHISTORYID as TestPlanHistoryID,
				Txn_TestHistoryMin.minTestOrder as TestOrder,
				Txn_TestHistory.ZBTESTNAME as TestName,
				NCR.NCRCOMMENT,
				NCR.NonconformanceReportName
			FROM      
				/shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/CDODEFINITION CDODEFINITION
			 RIGHT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/HISTORYMAINLINE HISTORYMAINLINE ON CDODEFINITION.CDODEFID = HISTORYMAINLINE.TXNTYPE 
			 INNER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/EMPLOYEE EMPLOYEE ON EMPLOYEE.EMPLOYEEID = HISTORYMAINLINE.EMPLOYEEID 
			 INNER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/HISTORYCROSSREF HISTORYCROSSREF ON HISTORYMAINLINE.HISTORYID = HISTORYCROSSREF.HISTORYID AND HISTORYMAINLINE.TXNID BETWEEN HISTORYCROSSREF.STARTTXNID AND HISTORYCROSSREF.ENDTXNID
			 INNER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/CONTAINER CONTAINER ON HISTORYCROSSREF.TRACKINGID = CONTAINER.CONTAINERID 
			 LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/NONCONFORMANCEREPORT NCR ON CONTAINER.CONTAINERID = NCR.CONTAINERID
			 LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/WORKFLOWSTEP Table__140  ON Table__140.WORKFLOWSTEPID = NCR.CHARGETOSTEPID 
			 LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZCROOTCAUSECODE ZCROOTCAUSECODE ON ZCROOTCAUSECODE.ZCROOTCAUSECODEID = NCR.ZCROOTCAUSECODEID
			 LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZCNONCONFORMANCECODE ZCNONCONFORMANCECODE ON ZCNONCONFORMANCECODE.ZCNONCONFORMANCECODEID = NCR.ZCNONCONFORMANCECODEID 
			 LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/WORKFLOWBASE NCC_WORKFLOWBASE ON NCC_WORKFLOWBASE.WORKFLOWBASEID = ZCNONCONFORMANCECODE.ZCANALYSISWORKFLOWBASEID
			 LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZCFAILUREMODECODE ZCFAILUREMODECODE ON ZCFAILUREMODECODE.ZCFAILUREMODECODEID = NCR.ZCFAILUREMODECODEID 
			 LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZCDISPOSITIONCODE ZCDISPOSITIONCODE ON ZCDISPOSITIONCODE.ZCDISPOSITIONCODEID = NCR.ZCDISPOSITIONCODEID 
			 LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/PRODUCT Table__358 ON NCR.ZCFAILUREMODEPRODUCTID = Table__358.PRODUCTID 
			 LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/PRODUCTBASE Table__359 ON Table__359.PRODUCTBASEID = Table__358.PRODUCTBASEID
			 LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZCCAR ICAR ON NCR.ZCICARID = ICAR.ZCCARID
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZBTESTPLANHISTORY ZBTESTPLANHISTORY ON NCR.ZCRELATEDTESTPLANHISTORYID = ZBTESTPLANHISTORY.ZBTESTPLANHISTORYID
			  LEFT OUTER  JOIN
			 (SELECT
				CONTAINER.CONTAINERID,
				Txn_TestHistory.ZBTESTPLANHISTORYID,
				min (Txn_TestHistory.ZBTESTORDER)  as minTestOrder
			  FROM 
				/shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/CONTAINER 
				INNER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/HISTORYCROSSREF ON (HISTORYCROSSREF.TRACKINGID=CONTAINER.CONTAINERID)
			   INNER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/HISTORYMAINLINE  HISTORYMAINLINE ON (HISTORYMAINLINE.HISTORYID=HISTORYCROSSREF.HISTORYID AND HISTORYMAINLINE.TXNID BETWEEN HISTORYCROSSREF.STARTTXNID AND HISTORYCROSSREF.ENDTXNID)
			   LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZBTESTPLANHISTORY ON (HISTORYMAINLINE.HISTORYMAINLINEID=ZBTESTPLANHISTORY.HISTORYMAINLINEID)
				LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZBTESTHISTORY  Txn_TestHistory ON ZBTESTPLANHISTORY.ZBTESTPLANHISTORYID=Txn_TestHistory.ZBTESTPLANHISTORYID
				LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZBTESTRESULTHISTORY  Txn_TestResultHistory ON (Txn_TestHistory.ZBTESTHISTORYID=Txn_TestResultHistory.ZBTESTHISTORYID)
			  WHERE 
				Txn_TestResultHistory.ZBJUDGEMENTTYPEID = ''48002120000000b4''
			GROUP BY	
				CONTAINER.CONTAINERID,
				Txn_TestHistory.ZBTESTPLANHISTORYID
			) Txn_TestHistoryMin ON  Txn_TestHistoryMin.ZBTESTPLANHISTORYID = ZBTESTPLANHISTORY.ZBTESTPLANHISTORYID and CONTAINER.CONTAINERID = Txn_TestHistoryMin.CONTAINERID
			LEFT OUTER JOIN /shared/MES7/MES7PRD/MES7PRD_LMT_TMP_RO/ZBTESTHISTORY  Txn_TestHistory ON Txn_TestHistoryMin.ZBTESTPLANHISTORYID=Txn_TestHistory.ZBTESTPLANHISTORYID AND Txn_TestHistory.ZBTESTORDER = Txn_TestHistoryMin.minTestOrder	 
			   
			WHERE
				CDODEFINITION.CDONAME IN (''zcNCRCreate'', ''zcNCRClose'') and CONTAINER.CONTAINERID in (',containerIdsList),')');
    END